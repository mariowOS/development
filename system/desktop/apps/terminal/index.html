<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    @font-face {
      font-family: 'Unifont Ex Mono';
      src: url('unifont-ex-mono.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Unifont Ex Mono', monospace !important;
      color: #fff;
    }

    html, body {
      height: 100%;
      background: #000;
      overflow: hidden;
    }

    .terminal {
      padding: 20px;
      font-size: 16px;
      line-height: 1.5;
      white-space: pre-wrap;
      height: 100vh;
      overflow-y: auto;
      user-select: none;
      scrollbar-width: none;
      -ms-overflow-style: none;
      text-shadow: 0 0 3px #0f0;
    }

    .terminal::-webkit-scrollbar {
      display: none;
    }

    .user {
      color: #00ff00;
    }

    .cursor {
      display: inline-block;
      width: 8px;
      height: 18px;
      background: #00ff00;
      margin-left: 2px;
      vertical-align: middle;
    }

    ::selection {
      background: #fff;
      color: #000;
    }
  </style>
</head>
<body>
  <div class="terminal" id="terminal" tabindex="0"></div>

  <script>
    const terminal = document.getElementById("terminal");

    let inputBuffer = "";
    let cursorVisible = true;
    let history = [];
    let historyIndex = -1;

    // Initialize
    let currentInput, currentCursor;
    newPrompt();

    // Blink cursor
    setInterval(() => {
      if (currentCursor)
        currentCursor.style.visibility = cursorVisible ? "visible" : "hidden";
      cursorVisible = !cursorVisible;
    }, 500);

    // Focus terminal when clicked
    terminal.addEventListener("click", () => terminal.focus());
    window.addEventListener("click", () => terminal.focus());

    document.addEventListener("keydown", (e) => {
      if (
        ["Backspace", "Enter", "ArrowUp", "ArrowDown"].includes(e.key) ||
        (e.key.length === 1 && !e.ctrlKey && !e.metaKey)
      ) {
        e.preventDefault();
      }

      if (!currentInput) return;

      if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {
        inputBuffer += e.key;
      } else if (e.key === "Backspace") {
        inputBuffer = inputBuffer.slice(0, -1);
      } else if (e.key === "Enter") {
        const cmd = inputBuffer.trim();
        executeCommand(cmd);
        history.push(cmd);
        historyIndex = history.length;
        inputBuffer = "";
        return;
      } else if (e.key === "ArrowUp") {
        if (historyIndex > 0) {
          historyIndex--;
          inputBuffer = history[historyIndex];
        }
      } else if (e.key === "ArrowDown") {
        if (historyIndex < history.length - 1) {
          historyIndex++;
          inputBuffer = history[historyIndex];
        } else {
          historyIndex = history.length;
          inputBuffer = "";
        }
      }

      currentInput.textContent = inputBuffer;
      terminal.scrollTop = terminal.scrollHeight;
    });

    function newPrompt() {
      const line = document.createElement("div");
      line.innerHTML = `<span class="user">user@mariowos</span>:$ <span class="input"></span><span class="cursor"></span>`;
      terminal.appendChild(line);
      terminal.scrollTop = terminal.scrollHeight;

      currentInput = line.querySelector(".input");
      currentCursor = line.querySelector(".cursor");
      inputBuffer = "";
    }

    function executeCommand(cmd) {
      if (!cmd) {
        newPrompt();
        return;
      }

      const outputLine = document.createElement("div");

      switch (cmd.split(" ")[0]) {
        case "help":
          outputLine.innerText = `Available commands:
help - Show help
about - About this terminal
clear - Clear the screen
echo [text] - Print a message
math [expr] - Simple math calculator`;
          terminal.appendChild(outputLine);
          break;

        case "about":
          outputLine.innerText = `mariowOS Terminal v0.7
(C) 2025 mariowstech and the mariowOS team`;
          terminal.appendChild(outputLine);
          break;

        case "clear":
          terminal.innerHTML = "";
          currentInput = null;
          currentCursor = null;
          inputBuffer = "";
          newPrompt();
          return;

        case "echo":
          outputLine.innerText = cmd.slice(5);
          terminal.appendChild(outputLine);
          break;

        case "math":
          try {
            const expr = cmd.slice(5);
            const result = eval(expr);
            outputLine.innerText = `${expr} = ${result}`;
          } catch {
            outputLine.innerText = "Errore: espressione non valida.";
          }
          terminal.appendChild(outputLine);
          break;

        default:
          outputLine.innerText = `Command not found: ${cmd}`;
          terminal.appendChild(outputLine);
      }

      terminal.scrollTop = terminal.scrollHeight;
      newPrompt();
    }
  </script>
</body>
</html>
